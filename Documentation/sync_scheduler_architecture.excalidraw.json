{
  "type": "excalidraw",
  "version": 2,
  "source": "boeing-data-hub-scheduler-design",
  "elements": [
    {
      "id": "title",
      "type": "text",
      "x": 400,
      "y": 20,
      "width": 600,
      "height": 45,
      "text": "Boeing Product Sync Scheduler - Architecture v2",
      "fontSize": 28,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 32,
      "strokeColor": "#1e1e1e"
    },
    {
      "id": "celery-beat-box",
      "type": "rectangle",
      "x": 50,
      "y": 100,
      "width": 200,
      "height": 80,
      "strokeColor": "#2f9e44",
      "backgroundColor": "#b2f2bb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "celery-beat-text",
      "type": "text",
      "x": 80,
      "y": 120,
      "width": 140,
      "height": 50,
      "text": "CELERY BEAT\n(Scheduler)",
      "fontSize": 16,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "hourly-trigger-text",
      "type": "text",
      "x": 60,
      "y": 190,
      "width": 180,
      "height": 20,
      "text": "Every hour at HH:00",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#868e96"
    },
    {
      "id": "catchup-trigger-text",
      "type": "text",
      "x": 60,
      "y": 210,
      "width": 180,
      "height": 20,
      "text": "Every 15 minutes",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#868e96"
    },
    {
      "id": "arrow-beat-to-hourly",
      "type": "arrow",
      "x": 250,
      "y": 130,
      "width": 100,
      "height": 0,
      "points": [[0, 0], [100, 0]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "hourly-dispatcher-box",
      "type": "rectangle",
      "x": 350,
      "y": 100,
      "width": 220,
      "height": 100,
      "strokeColor": "#1971c2",
      "backgroundColor": "#a5d8ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "hourly-dispatcher-text",
      "type": "text",
      "x": 370,
      "y": 110,
      "width": 180,
      "height": 80,
      "text": "HOURLY BUCKET\nDISPATCHER\n\nQueue: sync_dispatch",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "catchup-dispatcher-box",
      "type": "rectangle",
      "x": 350,
      "y": 220,
      "width": 220,
      "height": 80,
      "strokeColor": "#e8590c",
      "backgroundColor": "#ffc078",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "catchup-dispatcher-text",
      "type": "text",
      "x": 370,
      "y": 235,
      "width": 180,
      "height": 50,
      "text": "CATCH-UP\nDISPATCHER\n(Recovery)",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-beat-to-catchup",
      "type": "arrow",
      "x": 250,
      "y": 160,
      "width": 100,
      "height": 100,
      "points": [[0, 0], [50, 0], [50, 100], [100, 100]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "supabase-db-box",
      "type": "rectangle",
      "x": 650,
      "y": 100,
      "width": 200,
      "height": 200,
      "strokeColor": "#9c36b5",
      "backgroundColor": "#eebefa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "supabase-db-text",
      "type": "text",
      "x": 680,
      "y": 110,
      "width": 140,
      "height": 180,
      "text": "SUPABASE DB\n\nproduct_sync_schedule\nâ”œâ”€ hour_bucket\nâ”œâ”€ minute_offset\nâ”œâ”€ next_sync_at\nâ”œâ”€ last_boeing_hash\nâ””â”€ is_active\n\nsync_audit_log",
      "fontSize": 12,
      "fontFamily": 3,
      "textAlign": "left"
    },
    {
      "id": "arrow-hourly-to-db",
      "type": "arrow",
      "x": 570,
      "y": 150,
      "width": 80,
      "height": 0,
      "points": [[0, 0], [80, 0]],
      "strokeColor": "#9c36b5",
      "strokeWidth": 2,
      "startArrowhead": "arrow",
      "endArrowhead": "arrow"
    },
    {
      "id": "db-query-text",
      "type": "text",
      "x": 575,
      "y": 130,
      "width": 70,
      "height": 16,
      "text": "FOR UPDATE\nSKIP LOCKED",
      "fontSize": 10,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#9c36b5"
    },
    {
      "id": "arrow-hourly-to-batches",
      "type": "arrow",
      "x": 460,
      "y": 200,
      "width": 0,
      "height": 150,
      "points": [[0, 0], [0, 150]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "batches-label",
      "type": "text",
      "x": 470,
      "y": 280,
      "width": 100,
      "height": 40,
      "text": "Creates batches\nof 10 SKUs",
      "fontSize": 11,
      "fontFamily": 1,
      "textAlign": "left",
      "strokeColor": "#868e96"
    },
    {
      "id": "redis-queue-box",
      "type": "rectangle",
      "x": 50,
      "y": 370,
      "width": 800,
      "height": 60,
      "strokeColor": "#c92a2a",
      "backgroundColor": "#ffc9c9",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "redis-queue-text",
      "type": "text",
      "x": 350,
      "y": 385,
      "width": 200,
      "height": 30,
      "text": "REDIS QUEUES\nsync_boeing | sync_shopify",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "rate-limiter-box",
      "type": "rectangle",
      "x": 50,
      "y": 460,
      "width": 200,
      "height": 100,
      "strokeColor": "#f08c00",
      "backgroundColor": "#ffec99",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "rate-limiter-text",
      "type": "text",
      "x": 70,
      "y": 475,
      "width": 160,
      "height": 70,
      "text": "GLOBAL RATE\nLIMITER\n(Redis Token Bucket)\n2 tokens/min",
      "fontSize": 13,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-queue-to-limiter",
      "type": "arrow",
      "x": 150,
      "y": 430,
      "width": 0,
      "height": 30,
      "points": [[0, 0], [0, 30]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "sync-batch-worker-box",
      "type": "rectangle",
      "x": 300,
      "y": 460,
      "width": 220,
      "height": 100,
      "strokeColor": "#1971c2",
      "backgroundColor": "#a5d8ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "sync-batch-worker-text",
      "type": "text",
      "x": 320,
      "y": 470,
      "width": 180,
      "height": 80,
      "text": "SYNC BATCH TASK\n\nQueue: sync_boeing\nConcurrency: 1\n(or token bucket)",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-limiter-to-worker",
      "type": "arrow",
      "x": 250,
      "y": 510,
      "width": 50,
      "height": 0,
      "points": [[0, 0], [50, 0]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "acquire-token-text",
      "type": "text",
      "x": 255,
      "y": 490,
      "width": 45,
      "height": 16,
      "text": "acquire\ntoken",
      "fontSize": 9,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#868e96"
    },
    {
      "id": "boeing-api-box",
      "type": "rectangle",
      "x": 300,
      "y": 600,
      "width": 220,
      "height": 80,
      "strokeColor": "#0c8599",
      "backgroundColor": "#99e9f2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "boeing-api-text",
      "type": "text",
      "x": 340,
      "y": 615,
      "width": 140,
      "height": 50,
      "text": "BOEING API\n\nMax 10 SKUs/call\nRate: 2 calls/min",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-worker-to-boeing",
      "type": "arrow",
      "x": 410,
      "y": 560,
      "width": 0,
      "height": 40,
      "points": [[0, 0], [0, 40]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "change-detection-box",
      "type": "diamond",
      "x": 570,
      "y": 470,
      "width": 140,
      "height": 80,
      "strokeColor": "#5c940d",
      "backgroundColor": "#d8f5a2",
      "fillStyle": "solid",
      "strokeWidth": 2
    },
    {
      "id": "change-detection-text",
      "type": "text",
      "x": 595,
      "y": 495,
      "width": 90,
      "height": 30,
      "text": "CHANGE\nDETECTED?",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-worker-to-change",
      "type": "arrow",
      "x": 520,
      "y": 510,
      "width": 50,
      "height": 0,
      "points": [[0, 0], [50, 0]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "hash-compare-text",
      "type": "text",
      "x": 525,
      "y": 490,
      "width": 45,
      "height": 16,
      "text": "SHA256\ncompare",
      "fontSize": 9,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#868e96"
    },
    {
      "id": "shopify-sync-box",
      "type": "rectangle",
      "x": 750,
      "y": 470,
      "width": 180,
      "height": 80,
      "strokeColor": "#862e9c",
      "backgroundColor": "#e599f7",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "shopify-sync-text",
      "type": "text",
      "x": 770,
      "y": 485,
      "width": 140,
      "height": 50,
      "text": "SHOPIFY SYNC\nTASK\n\nRate: 30/min",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-change-to-shopify",
      "type": "arrow",
      "x": 710,
      "y": 510,
      "width": 40,
      "height": 0,
      "points": [[0, 0], [40, 0]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "yes-text",
      "type": "text",
      "x": 720,
      "y": 495,
      "width": 25,
      "height": 12,
      "text": "YES",
      "fontSize": 10,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#2f9e44"
    },
    {
      "id": "no-change-text",
      "type": "text",
      "x": 610,
      "y": 555,
      "width": 60,
      "height": 12,
      "text": "NO â†’ Skip",
      "fontSize": 10,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#c92a2a"
    },
    {
      "id": "shopify-api-box",
      "type": "rectangle",
      "x": 750,
      "y": 600,
      "width": 180,
      "height": 80,
      "strokeColor": "#862e9c",
      "backgroundColor": "#e599f7",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "id": "shopify-api-text",
      "type": "text",
      "x": 780,
      "y": 615,
      "width": 120,
      "height": 50,
      "text": "SHOPIFY API\n\nUpdate price/qty\nif changed",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "arrow-shopify-task-to-api",
      "type": "arrow",
      "x": 840,
      "y": 550,
      "width": 0,
      "height": 50,
      "points": [[0, 0], [0, 50]],
      "strokeColor": "#1e1e1e",
      "strokeWidth": 2
    },
    {
      "id": "db-update-arrow",
      "type": "arrow",
      "x": 750,
      "y": 320,
      "width": 0,
      "height": 150,
      "points": [[0, 0], [0, 150]],
      "strokeColor": "#9c36b5",
      "strokeWidth": 2,
      "startArrowhead": "arrow"
    },
    {
      "id": "db-update-text",
      "type": "text",
      "x": 755,
      "y": 370,
      "width": 80,
      "height": 30,
      "text": "Update\nnext_sync_at\n(anchored)",
      "fontSize": 9,
      "fontFamily": 1,
      "textAlign": "left",
      "strokeColor": "#9c36b5"
    },
    {
      "id": "timeline-box",
      "type": "rectangle",
      "x": 50,
      "y": 720,
      "width": 880,
      "height": 180,
      "strokeColor": "#495057",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roundness": { "type": 3 }
    },
    {
      "id": "timeline-title",
      "type": "text",
      "x": 400,
      "y": 730,
      "width": 180,
      "height": 20,
      "text": "TIMELINE (Hour 14 Example)",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center",
      "strokeColor": "#1e1e1e"
    },
    {
      "id": "timeline-content",
      "type": "text",
      "x": 70,
      "y": 755,
      "width": 840,
      "height": 140,
      "text": "14:00:00  Celery Beat â†’ Hourly Dispatcher (bucket=14)\n14:00:01  Query: SELECT ... WHERE hour_bucket=14 FOR UPDATE SKIP LOCKED â†’ 42 products\n14:00:02  Create 5 batches (10 SKUs each) â†’ Queue to sync_boeing\n\n14:00:02  Batch 1 acquires token â†’ Boeing API call\n14:00:32  Batch 2 acquires token â†’ Boeing API call  (rate: 2/min)\n14:01:02  Batch 3 acquires token â†’ Boeing API call\n14:01:32  Batch 4 acquires token â†’ Boeing API call\n14:02:02  Batch 5 acquires token â†’ Boeing API call\n\n14:02:30  All 42 products synced. 3 had changes â†’ 3 Shopify updates queued\n14:02:35  Shopify updates complete (rate: 30/min, so ~6 seconds for 3)\n14:15:00  Catch-up dispatcher runs â†’ Finds 0 overdue (all processed on time)",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "strokeColor": "#495057"
    },
    {
      "id": "legend-box",
      "type": "rectangle",
      "x": 50,
      "y": 920,
      "width": 880,
      "height": 80,
      "strokeColor": "#495057",
      "backgroundColor": "#ffffff",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roundness": { "type": 3 }
    },
    {
      "id": "legend-title",
      "type": "text",
      "x": 60,
      "y": 930,
      "width": 60,
      "height": 16,
      "text": "LEGEND:",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "left"
    },
    {
      "id": "legend-content",
      "type": "text",
      "x": 60,
      "y": 950,
      "width": 860,
      "height": 45,
      "text": "ðŸŸ¢ Green = Scheduler    ðŸ”µ Blue = Dispatcher/Worker    ðŸŸ  Orange = Catch-up    ðŸŸ£ Purple = Database/Shopify\nðŸ”´ Red = Redis Queue    ðŸŸ¡ Yellow = Rate Limiter    ðŸ”· Cyan = Boeing API    ðŸŸ¢ Diamond = Decision",
      "fontSize": 11,
      "fontFamily": 1,
      "textAlign": "left"
    },
    {
      "id": "key-features-box",
      "type": "rectangle",
      "x": 950,
      "y": 100,
      "width": 280,
      "height": 400,
      "strokeColor": "#495057",
      "backgroundColor": "#fff9db",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roundness": { "type": 3 }
    },
    {
      "id": "key-features-title",
      "type": "text",
      "x": 1020,
      "y": 110,
      "width": 140,
      "height": 20,
      "text": "KEY FEATURES v2",
      "fontSize": 14,
      "fontFamily": 1,
      "textAlign": "center"
    },
    {
      "id": "key-features-content",
      "type": "text",
      "x": 960,
      "y": 135,
      "width": 260,
      "height": 360,
      "text": "âœ… STABLE HASHING\n   SHA-256 for deterministic\n   slot assignment\n\nâœ… ANCHORED SCHEDULING\n   next_sync_at = slot time\n   (no drift)\n\nâœ… BUCKET DISPATCH\n   24 queries/day (hourly)\n   + 96 catch-up queries\n   = 92% fewer DB queries\n\nâœ… GLOBAL RATE LIMIT\n   Redis token bucket\n   (not per-worker)\n\nâœ… ROW LOCKING\n   FOR UPDATE SKIP LOCKED\n   (no duplicate processing)\n\nâœ… CHANGE DETECTION\n   Hash relevant fields only\n   (price, qty, stock)\n\nâœ… RECOVERY\n   Catch-up dispatcher\n   every 15 minutes",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left"
    }
  ],
  "appState": {
    "viewBackgroundColor": "#ffffff",
    "gridSize": 20
  }
}
